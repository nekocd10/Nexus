#!/usr/bin/env python3
"""
Nexus Programming Language Interpreter
Main CLI interface - completely original language
"""

import sys
import os
from nexus_interpreter import run_nexus
from nexus_lexer import NexusLexer
from nexus_parser import parse_nexus

def main():
    if len(sys.argv) < 2:
        print("Nexus Programming Language Interpreter")
        print("A completely original language with unique syntax and paradigms")
        print()
        print("Usage: nexus <file.nexus>")
        print("       nexus --repl")
        print("       nexus --tokens <file.nexus>")
        print("       nexus --ast <file.nexus>")
        sys.exit(1)
    
    command = sys.argv[1]
    
    if command == '--repl':
        run_repl()
    elif command == '--tokens':
        if len(sys.argv) < 3:
            print("Usage: nexus --tokens <file.nexus>")
            sys.exit(1)
        show_tokens(sys.argv[2])
    elif command == '--ast':
        if len(sys.argv) < 3:
            print("Usage: nexus --ast <file.nexus>")
            sys.exit(1)
        show_ast(sys.argv[2])
    else:
        # Execute file
        if not os.path.exists(command):
            print(f"Error: File '{command}' not found")
            sys.exit(1)
        
        with open(command, 'r') as f:
            source = f.read()
        
        try:
            run_nexus(source)
        except Exception as e:
            print(f"Error: {e}", file=sys.stderr)
            import traceback
            traceback.print_exc()
            sys.exit(1)

def run_repl():
    """Interactive REPL mode"""
    print("Nexus REPL (type 'exit' to quit)")
    from nexus_interpreter import NexusInterpreter
    
    interpreter = NexusInterpreter()
    
    while True:
        try:
            line = input("nexus> ")
            if line.strip() == 'exit':
                break
            if not line.strip():
                continue
            
            ast = parse_nexus(line)
            result = interpreter.interpret(ast)
            if result is not None:
                print(result)
        
        except KeyboardInterrupt:
            print()
            continue
        except Exception as e:
            print(f"Error: {e}")

def show_tokens(filename):
    """Show tokens for a file"""
    with open(filename, 'r') as f:
        source = f.read()
    
    lexer = NexusLexer(source)
    tokens = lexer.tokenize()
    
    print(f"Tokens for {filename}:")
    print("-" * 60)
    for token in tokens:
        print(f"{token.type.name:25} {str(token.value):20} Line {token.line}:{token.column}")

def show_ast(filename):
    """Show AST for a file"""
    with open(filename, 'r') as f:
        source = f.read()
    
    ast = parse_nexus(source)
    
    print(f"AST for {filename}:")
    print("-" * 60)
    print(ast)

if __name__ == '__main__':
    main()
